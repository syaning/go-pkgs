<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>bytes | Go语言标准包解析</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/go-pkgs/assets/css/styles.fe7484d0.css" as="style"><link rel="preload" href="/go-pkgs/assets/js/app.fe7484d0.js" as="script"><link rel="preload" href="/go-pkgs/assets/js/5.3cc74dc1.js" as="script"><link rel="prefetch" href="/go-pkgs/assets/js/14.f9e1edcd.js"><link rel="prefetch" href="/go-pkgs/assets/css/1.styles.5a8ea794.css"><link rel="prefetch" href="/go-pkgs/assets/js/1.5a8ea794.js"><link rel="prefetch" href="/go-pkgs/assets/css/2.styles.99eb2c41.css"><link rel="prefetch" href="/go-pkgs/assets/js/2.99eb2c41.js"><link rel="prefetch" href="/go-pkgs/assets/js/3.3ba8b41e.js"><link rel="prefetch" href="/go-pkgs/assets/js/4.45a9b36b.js"><link rel="prefetch" href="/go-pkgs/assets/js/6.760749db.js"><link rel="prefetch" href="/go-pkgs/assets/js/7.5ff195c7.js"><link rel="prefetch" href="/go-pkgs/assets/js/8.bada7560.js"><link rel="prefetch" href="/go-pkgs/assets/js/9.02d5f6a8.js"><link rel="prefetch" href="/go-pkgs/assets/js/10.ef8c01c5.js"><link rel="prefetch" href="/go-pkgs/assets/js/11.1f8351a8.js"><link rel="prefetch" href="/go-pkgs/assets/js/12.7bfed0a7.js"><link rel="prefetch" href="/go-pkgs/assets/js/13.aad6c30f.js"><link rel="prefetch" href="/go-pkgs/assets/js/15.e2eeb8f5.js"><link rel="prefetch" href="/go-pkgs/assets/js/16.f9ee11ce.js"><link rel="prefetch" href="/go-pkgs/assets/js/17.908a31d6.js"><link rel="prefetch" href="/go-pkgs/assets/js/18.7a1df7b7.js"><link rel="prefetch" href="/go-pkgs/assets/js/19.dc583434.js"><link rel="prefetch" href="/go-pkgs/assets/js/20.ccf17788.js"><link rel="prefetch" href="/go-pkgs/assets/js/21.4a01e5ec.js"><link rel="prefetch" href="/go-pkgs/assets/js/22.c3ca65cd.js"><link rel="prefetch" href="/go-pkgs/assets/js/23.8d11c56f.js"><link rel="prefetch" href="/go-pkgs/assets/js/24.1b50e3b4.js"><link rel="prefetch" href="/go-pkgs/assets/js/25.51739cb2.js"><link rel="prefetch" href="/go-pkgs/assets/js/26.33ca2889.js"><link rel="prefetch" href="/go-pkgs/assets/js/27.a258b5a4.js"><link rel="prefetch" href="/go-pkgs/assets/js/28.86f54ae6.js"><link rel="prefetch" href="/go-pkgs/assets/js/29.3dc10855.js"><link rel="prefetch" href="/go-pkgs/assets/js/30.87502924.js"><link rel="prefetch" href="/go-pkgs/assets/js/31.4e990cb9.js"><link rel="prefetch" href="/go-pkgs/assets/js/32.fad9d836.js">
    <link rel="stylesheet" href="/go-pkgs/assets/css/1.styles.5a8ea794.css"><link rel="stylesheet" href="/go-pkgs/assets/css/2.styles.99eb2c41.css"><link rel="stylesheet" href="/go-pkgs/assets/css/styles.fe7484d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/go-pkgs/" class="home-link router-link-active"><!----> <span class="site-name">Go语言标准包解析</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/syaning/go-pkgs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/syaning/go-pkgs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/go-pkgs/" class="sidebar-link">Go语言标准包解析</a></li><li><a href="/go-pkgs/errors/" class="sidebar-link">errors</a></li><li><a href="/go-pkgs/io/" class="sidebar-link">io</a></li><li><a href="/go-pkgs/bufio/" class="sidebar-link">bufio</a></li><li><a href="/go-pkgs/bytes/" class="active sidebar-link">bytes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/go-pkgs/bytes/#基本操作" class="sidebar-link">基本操作</a></li><li class="sidebar-sub-header"><a href="/go-pkgs/bytes/#buffer" class="sidebar-link">Buffer</a></li><li class="sidebar-sub-header"><a href="/go-pkgs/bytes/#reader" class="sidebar-link">Reader</a></li></ul></li><li><a href="/go-pkgs/strings/" class="sidebar-link">strings</a></li><li><a href="/go-pkgs/strconv/" class="sidebar-link">strconv</a></li><li><a href="/go-pkgs/container/heap.html" class="sidebar-link">container/heap</a></li><li><a href="/go-pkgs/container/list.html" class="sidebar-link">container/list</a></li><li><a href="/go-pkgs/container/ring.html" class="sidebar-link">container/ring</a></li><li><a href="/go-pkgs/os/" class="sidebar-link">os</a></li><li><a href="/go-pkgs/path/" class="sidebar-link">path</a></li><li><a href="/go-pkgs/path/filepath.html" class="sidebar-link">path/filepath</a></li><li><a href="/go-pkgs/hash/" class="sidebar-link">hash</a></li><li><a href="/go-pkgs/hash/adler32.html" class="sidebar-link">hash/adler32</a></li><li><a href="/go-pkgs/net/" class="sidebar-link">net</a></li><li><a href="/go-pkgs/net/http.html" class="sidebar-link">net/http</a></li><li><a href="/go-pkgs/net/textproto.html" class="sidebar-link">net/textproto</a></li><li><a href="/go-pkgs/net/url.html" class="sidebar-link">net/url</a></li><li><a href="/go-pkgs/time/" class="sidebar-link">time</a></li><li><a href="/go-pkgs/sync/" class="sidebar-link">sync</a></li><li><a href="/go-pkgs/log/" class="sidebar-link">log</a></li><li><a href="/go-pkgs/encoding/base32.html" class="sidebar-link">encoding/base32</a></li><li><a href="/go-pkgs/encoding/base64.html" class="sidebar-link">encoding/base64</a></li><li><a href="/go-pkgs/encoding/hex.html" class="sidebar-link">encoding/hex</a></li><li><a href="/go-pkgs/encoding/json.html" class="sidebar-link">encoding/json</a></li><li><a href="/go-pkgs/crypto/md5.html" class="sidebar-link">crypto/md5</a></li><li><a href="/go-pkgs/crypto/sha256.html" class="sidebar-link">crypto/sha256</a></li><li><a href="/go-pkgs/crypto/hmac.html" class="sidebar-link">crypto/hmac</a></li><li><a href="/go-pkgs/reflect/" class="sidebar-link">reflect</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="bytes"><a href="#bytes" aria-hidden="true" class="header-anchor">#</a> bytes</h1> <h2 id="基本操作"><a href="#基本操作" aria-hidden="true" class="header-anchor">#</a> 基本操作</h2> <h3 id="比较"><a href="#比较" aria-hidden="true" class="header-anchor">#</a> 比较</h3> <p>和比较相关的方法有：</p> <ul><li>func Equal(a, b []byte) bool</li> <li>func EqualFold(s, t []byte) bool</li> <li>func Compare(a, b []byte) int</li></ul> <p>其中<code>Equal</code>和<code>Compare</code>是使用汇编来实现的。</p> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// false</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -1</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><p><code>EqualFold</code>会忽略大小写，同时会将特殊字符进行转换。例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello ϕ&quot;</span><span class="token punctuation">)</span>
b <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Φ&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">EqualFold</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><h3 id="index"><a href="#index" aria-hidden="true" class="header-anchor">#</a> index</h3> <p>和index相关的方法有：</p> <ul><li>func Index(s, sep []byte) int</li> <li>func IndexAny(s []byte, chars string) int</li> <li>func IndexByte(s []byte, c byte) int</li> <li>func IndexFunc(s []byte, f func(r rune) bool) int</li> <li>func IndexRune(s []byte, r rune) int</li> <li>func LastIndex(s, sep []byte) int</li> <li>func LastIndexAny(s []byte, chars string) int</li> <li>func LastIndexByte(s []byte, c byte) int</li> <li>func LastIndexFunc(s []byte, f func(r rune) bool) int</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello 世界&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;llo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">IndexAny</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;ole&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// 1</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">IndexByte</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'l'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// 2</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">IndexRune</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'界'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// 9</span>
</code></pre></div><h3 id="包含"><a href="#包含" aria-hidden="true" class="header-anchor">#</a> 包含</h3> <p>和包含相关的方法有：</p> <ul><li>func Contains(b, subslice []byte) bool</li> <li>func ContainsAny(b []byte, chars string) bool</li> <li>func ContainsRune(b []byte, r rune) bool</li> <li>func Count(s, sep []byte) int</li> <li>func HasPrefix(s, prefix []byte) bool</li> <li>func HasSuffix(s, suffix []byte) bool</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello 世界&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;llo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">ContainsAny</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;llo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">ContainsRune</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'世'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment">// true</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;llo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 1</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;llo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">HasSuffix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;世界&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// true</span>
</code></pre></div><p>在源码中，<code>Contains[Any/Rune]</code>是通过<code>Index[Any/Rune]</code>来实现的，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ContainsAny</span><span class="token punctuation">(</span>b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> chars <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">IndexAny</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> chars<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>HasPrefix</code>和<code>HasSuffix</code>是通过<code>Equal</code>来实现的，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">HasPrefix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> prefix <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">len</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">Equal</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> prefix<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>###转换</p> <p>和转换相关的方法有：</p> <ul><li>func Title(s []byte) []byte</li> <li>func ToLower(s []byte) []byte</li> <li>func ToLowerSpecial(_case unicode.SpecialCase, s []byte) []byte</li> <li>func ToTitle(s []byte) []byte</li> <li>func ToTitleSpecial(_case unicode.SpecialCase, s []byte) []byte</li> <li>func ToUpper(s []byte) []byte</li> <li>func ToUpperSpecial(_case unicode.SpecialCase, s []byte) []byte</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;heLLo 世界&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Title</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// HeLLo 世界</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">ToLower</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello 世界</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">ToTitle</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// HELLO 世界</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// HELLO 世界</span>
</code></pre></div><h3 id="trim"><a href="#trim" aria-hidden="true" class="header-anchor">#</a> trim</h3> <p>和trim相关的方法有：</p> <ul><li>func Trim(s []byte, cutset string) []byte</li> <li>func TrimFunc(s []byte, f func(r rune) bool) []byte</li> <li>func TrimLeft(s []byte, cutset string) []byte</li> <li>func TrimLeftFunc(s []byte, f func(r rune) bool) []byte</li> <li>func TrimPrefix(s, prefix []byte) []byte</li> <li>func TrimRight(s []byte, cutset string) []byte</li> <li>func TrimRightFunc(s []byte, f func(r rune) bool) []byte</li> <li>func TrimSpace(s []byte) []byte</li> <li>func TrimSuffix(s, suffix []byte) []byte</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello olleh&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">TrimLeft</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;hel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">// o olleh</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">TrimRight</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;hel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">// hello o</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">&quot;hel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment">// o o</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">TrimPrefix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// lo olleh</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">TrimSuffix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;lleh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello o</span>
</code></pre></div><p>其中最基本的两个方法是<code>TrimLeftFunc</code>和<code>TrimRightFunc</code>，<code>TrimLeft</code>，<code>TrimRight</code>，<code>TrimFunc</code>都是基于这两个方法。例如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TrimFunc</span><span class="token punctuation">(</span>s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> f <span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token builtin">rune</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">TrimRightFunc</span><span class="token punctuation">(</span><span class="token function">TrimLeftFunc</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Trim</code>和<code>TrimSpace</code>都是基于<code>TrimFunc</code>方法。</p> <p><code>TrimPrefix</code>和<code>TrimSuffix</code>其实都是简单使用了切片操作。</p> <h3 id="split-和-join"><a href="#split-和-join" aria-hidden="true" class="header-anchor">#</a> split 和 join</h3> <p>相关方法有：</p> <ul><li>func Split(s, sep []byte) [][]byte</li> <li>func SplitAfter(s, sep []byte) [][]byte</li> <li>func SplitAfterN(s, sep []byte, n int) [][]byte</li> <li>func SplitN(s, sep []byte, n int) [][]byte</li> <li>func Fields(s []byte) [][]byte</li> <li>func FieldsFunc(s []byte, f func(rune) bool) [][]byte</li> <li>func Join(s [][]byte, sep []byte) []byte</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello,world,welcome&quot;</span><span class="token punctuation">)</span>

arr <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// hello world welcome</span>

arr <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">SplitAfter</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// hello, world, welcome</span>
</code></pre></div><p><code>SplitAfter</code>相比于<code>Split</code>，会包含分隔符。</p> <p><code>SplitN</code>和<code>SplitAfterN</code>与<code>Split</code>和<code>SplitAfter</code>相似，只不过限制了最大的切分个数，超过部分不再切分。例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello,world,welcome&quot;</span><span class="token punctuation">)</span>

arr <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">SplitN</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// hello world,welcome</span>
</code></pre></div><p><code>Fields</code>是通过连续的空字符来切分，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;  hello  world   welcome &quot;</span><span class="token punctuation">)</span>
arr <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">Fields</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> a <span class="token operator">:=</span> <span class="token keyword">range</span> arr <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// hello world welcome</span>
</code></pre></div><p><code>FieldsFunc</code>则是通过一个函数来检测切分条件，实际上，<code>Fields</code>是调用了<code>FieldsFunc</code>：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Fields</span><span class="token punctuation">(</span>s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">FieldsFunc</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> unicode<span class="token punctuation">.</span>IsSpace<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Join</code>用于连接操作，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;welcome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// hello, world, welcome</span>
</code></pre></div><h3 id="其它操作"><a href="#其它操作" aria-hidden="true" class="header-anchor">#</a> 其它操作</h3> <ul><li>func Map(mapping func(r rune) rune, s []byte) []byte</li> <li>func Repeat(b []byte, count int) []byte</li> <li>func Replace(s, old, new []byte, n int) []byte</li> <li>func Runes(s []byte) []rune</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Repeat</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                             <span class="token comment">// hellohellohello</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;l&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;L&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// heLlo</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;l&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;L&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// heLLo</span>

s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello 世界&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>              <span class="token comment">// [104 101 108 108 111 32 228 184 150 231 149 140]</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Runes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [104 101 108 108 111 32 19990 30028]</span>

f <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token builtin">rune</span><span class="token punctuation">)</span> <span class="token builtin">rune</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> r <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">Map</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;abcdefg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// bcdefgh</span>
</code></pre></div><h2 id="buffer"><a href="#buffer" aria-hidden="true" class="header-anchor">#</a> Buffer</h2> <p><code>Buffer</code>定义了一个缓冲区，其定义如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Buffer <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    buf       <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>            <span class="token comment">// contents are the bytes buf[off : len(buf)]</span>
    off       <span class="token builtin">int</span>               <span class="token comment">// read at &amp;buf[off], write at &amp;buf[len(buf)]</span>
    runeBytes <span class="token punctuation">[</span>utf8<span class="token punctuation">.</span>UTFMax<span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token comment">// avoid allocation of slice on each call to WriteRune</span>
    bootstrap <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token builtin">byte</span>          <span class="token comment">// memory to hold first slice; helps small buffers avoid allocation.</span>
    lastRead  readOp            <span class="token comment">// last read operation, so that Unread* can work correctly.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>它有一个内在的<code>buf</code>用于存储缓冲数据，<code>off</code>表示缓冲区起始位置。因此实际的数据位于<code>off</code>到<code>len(buf)</code>之间。执行<code>Read</code>操作的时候，会修改<code>off</code>的值；执行<code>Write</code>操作的时候，会改变<code>buf</code>的长度。</p> <p>可以通过如下方式创建新的<code>Buffer</code>：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> a bytes<span class="token punctuation">.</span>Buffer
b <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
c <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewBufferString</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="基本操作-2"><a href="#基本操作-2" aria-hidden="true" class="header-anchor">#</a> 基本操作</h3> <p><code>Buffer</code>的基本操作有：</p> <ul><li>func (b *Buffer) Len() int</li> <li>func (b *Buffer) Cap() int</li> <li>func (b *Buffer) Bytes() []byte</li> <li>func (b *Buffer) String() string</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>buf <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewBufferString</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
buf<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 4</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">Cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 8</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// [101 108 108 111]</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ello</span>
</code></pre></div><h3 id="truncate-和-grow"><a href="#truncate-和-grow" aria-hidden="true" class="header-anchor">#</a> Truncate 和 Grow</h3> <p><code>Truncate</code>可以截短缓冲区：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Buffer<span class="token punctuation">)</span> <span class="token function">Truncate</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>lastRead <span class="token operator">=</span> opInvalid
    <span class="token keyword">switch</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">&gt;</span> b<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;bytes.Buffer: truncation out of range&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token comment">// Reuse buffer space.</span>
        b<span class="token punctuation">.</span>off <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 截取前n个缓冲数据，如果n为0，则相当于buf重置</span>
    b<span class="token punctuation">.</span>buf <span class="token operator">=</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span><span class="token number">0</span> <span class="token punctuation">:</span> b<span class="token punctuation">.</span>off<span class="token operator">+</span>n<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>buf <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewBufferString</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
buf<span class="token punctuation">.</span><span class="token function">Truncate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token comment">// hel</span>
buf<span class="token punctuation">.</span><span class="token function">Truncate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
</code></pre></div><p><code>Reset</code>方法其实就是执行了<code>Truncate(0)</code>。</p> <p><code>Grow</code>可以扩展缓冲区从而确保可以容纳更多缓冲数据：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Buffer<span class="token punctuation">)</span> <span class="token function">Grow</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;bytes.Buffer.Grow: negative count&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    m <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">grow</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    <span class="token comment">// grow操作会在缓冲数据区之后增加一片空白区域</span>
    <span class="token comment">// m表示的是数据区的末尾位置</span>
    <span class="token comment">// 因此这里需要通过切片操作保证Len操作的正确性</span>
    b<span class="token punctuation">.</span>buf <span class="token operator">=</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>m<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Buffer<span class="token punctuation">)</span> <span class="token function">grow</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
    m <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 如果缓冲区为空，则重置</span>
    <span class="token keyword">if</span> m <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span>off <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span><span class="token function">Truncate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 超出缓冲区容量</span>
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>buf<span class="token punctuation">)</span><span class="token operator">+</span>n <span class="token operator">&gt;</span> <span class="token function">cap</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>buf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> buf <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
        <span class="token comment">// 初始化缓冲区</span>
        <span class="token keyword">if</span> b<span class="token punctuation">.</span>buf <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> n <span class="token operator">&lt;=</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>bootstrap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            buf <span class="token operator">=</span> b<span class="token punctuation">.</span>bootstrap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> m<span class="token operator">+</span>n <span class="token operator">&lt;=</span> <span class="token function">cap</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>buf<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span> <span class="token punctuation">{</span>
            <span class="token comment">// We can slide things down instead of allocating a new</span>
            <span class="token comment">// slice. We only need m+n &lt;= cap(b.buf) to slide, but</span>
            <span class="token comment">// we instead let capacity get twice as large so we</span>
            <span class="token comment">// don't spend all our time copying.</span>
            <span class="token comment">// m为当前缓冲区的数据量，n为扩展大小，或者说即将写入的数据量</span>
            <span class="token comment">// 因此m+n可以理解为新的缓冲数据量</span>
            <span class="token comment">// 如果缓冲数据量不超过一半容量，则不需要新分配内存</span>
            <span class="token function">copy</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span>b<span class="token punctuation">.</span>off<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            buf <span class="token operator">=</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>m<span class="token punctuation">]</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果缓冲数据量超过一半容量，则需要新分配内存</span>
            buf <span class="token operator">=</span> <span class="token function">makeSlice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token function">cap</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>buf<span class="token punctuation">)</span> <span class="token operator">+</span> n<span class="token punctuation">)</span>
            <span class="token function">copy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span>b<span class="token punctuation">.</span>off<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        b<span class="token punctuation">.</span>buf <span class="token operator">=</span> buf
        b<span class="token punctuation">.</span>off <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
    b<span class="token punctuation">.</span>buf <span class="token operator">=</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span><span class="token number">0</span> <span class="token punctuation">:</span> b<span class="token punctuation">.</span>off<span class="token operator">+</span>m<span class="token operator">+</span>n<span class="token punctuation">]</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span>off <span class="token operator">+</span> m
<span class="token punctuation">}</span>
</code></pre></div><h3 id="read"><a href="#read" aria-hidden="true" class="header-anchor">#</a> read</h3> <p><code>Read</code>操作从缓冲区中读取数据：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Buffer<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>lastRead <span class="token operator">=</span> opInvalid
    <span class="token comment">// 缓冲区为空，重置</span>
    <span class="token keyword">if</span> b<span class="token punctuation">.</span>off <span class="token operator">&gt;=</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>buf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span><span class="token function">Truncate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>EOF
    <span class="token punctuation">}</span>
    <span class="token comment">// 将数据从缓冲区中拷贝出来，并更新off的值</span>
    n <span class="token operator">=</span> <span class="token function">copy</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span>b<span class="token punctuation">.</span>off<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    b<span class="token punctuation">.</span>off <span class="token operator">+=</span> n
    <span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span>lastRead <span class="token operator">=</span> opRead
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre></div><p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>buf <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewBufferString</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span>
p <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
buf<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hel</span>
</code></pre></div><p><code>Next</code>方法与<code>Read</code>基本类似，只不过参数不是一个slice而是一个数值表示要读取的数据量，另外一个区别是：<code>Read</code>操作是从缓冲区拷贝数据到新的slice，而<code>Next</code>是对当前缓冲区直接进行slice操作并返回结果。</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Buffer<span class="token punctuation">)</span> <span class="token function">Next</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>lastRead <span class="token operator">=</span> opInvalid
    m <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> n <span class="token operator">&gt;</span> m <span class="token punctuation">{</span>
        n <span class="token operator">=</span> m
    <span class="token punctuation">}</span>
    <span class="token comment">// 对当前缓冲区直接进行slice操作</span>
    data <span class="token operator">:=</span> b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span>b<span class="token punctuation">.</span>off <span class="token punctuation">:</span> b<span class="token punctuation">.</span>off<span class="token operator">+</span>n<span class="token punctuation">]</span>
    b<span class="token punctuation">.</span>off <span class="token operator">+=</span> n
    <span class="token keyword">if</span> n <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span>lastRead <span class="token operator">=</span> opRead
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> data
<span class="token punctuation">}</span>
</code></pre></div><p>其它与read相关的方法有：</p> <ul><li>func (b *Buffer) ReadByte() (byte, error)</li> <li>func (b *Buffer) ReadBytes(delim byte) (line []byte, err error)</li> <li>func (b *Buffer) ReadRune() (r rune, size int, err error)</li> <li>func (b *Buffer) ReadString(delim byte) (line string, err error)</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>buf <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewBufferString</span><span class="token punctuation">(</span><span class="token string">&quot;hello,世界!&quot;</span><span class="token punctuation">)</span>

c<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> buf<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// h</span>

s<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> buf<span class="token punctuation">.</span><span class="token function">ReadBytes</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ello,</span>

r<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> buf<span class="token punctuation">.</span><span class="token function">ReadRune</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 世</span>

l<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> buf<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span> <span class="token comment">// 界!</span>
</code></pre></div><h3 id="write"><a href="#write" aria-hidden="true" class="header-anchor">#</a> write</h3> <p><code>Write</code>用于向缓冲区中写入数据：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Buffer<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>p <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">.</span>lastRead <span class="token operator">=</span> opInvalid
    <span class="token comment">// 首先通过grow操作确保缓冲区可以容纳更多的数据</span>
    m <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">grow</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 将数据拷贝到缓冲区中</span>
    <span class="token keyword">return</span> <span class="token function">copy</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>buf<span class="token punctuation">[</span>m<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其相关的方法有：</p> <ul><li>func (b *Buffer) Write(p []byte) (n int, err error)</li> <li>func (b *Buffer) WriteByte(c byte) error</li> <li>func (b *Buffer) WriteRune(r rune) (n int, err error)</li> <li>func (b *Buffer) WriteString(s string) (n int, err error)</li></ul> <p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">var</span> buf bytes<span class="token punctuation">.</span>Buffer

buf<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello</span>

buf<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello,</span>

buf<span class="token punctuation">.</span><span class="token function">WriteRune</span><span class="token punctuation">(</span><span class="token string">'世'</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello,世</span>

buf<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span><span class="token string">&quot;界!&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello,世界!</span>
</code></pre></div><h3 id="unread"><a href="#unread" aria-hidden="true" class="header-anchor">#</a> unread</h3> <p>unread操作会将已经读取的数据重新归入到缓冲区，本质上就是减小<code>off</code>的值。相关的方法有：</p> <ul><li>func (b *Buffer) UnreadByte() error</li> <li>func (b *Buffer) UnreadRune() error</li></ul> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>b <span class="token operator">*</span>Buffer<span class="token punctuation">)</span> <span class="token function">UnreadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只有当上一次的操作是读操作的时候才可以执行unread操作</span>
    <span class="token keyword">if</span> b<span class="token punctuation">.</span>lastRead <span class="token operator">!=</span> opReadRune <span class="token operator">&amp;&amp;</span> b<span class="token punctuation">.</span>lastRead <span class="token operator">!=</span> opRead <span class="token punctuation">{</span>
        <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;bytes.Buffer: UnreadByte: previous operation was not a read&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    b<span class="token punctuation">.</span>lastRead <span class="token operator">=</span> opInvalid
    <span class="token keyword">if</span> b<span class="token punctuation">.</span>off <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span>off<span class="token operator">--</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><p>例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>buf <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewBufferString</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>

buf<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token comment">// lo</span>

err <span class="token operator">:=</span> buf<span class="token punctuation">.</span><span class="token function">UnreadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token comment">// llo</span>
<span class="token punctuation">}</span>

buf<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
err <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">UnreadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// bytes.Buffer: UnreadByte: previous operation was not a read</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="readfrom-和-writeto"><a href="#readfrom-和-writeto" aria-hidden="true" class="header-anchor">#</a> ReadFrom 和 WriteTo</h3> <ul><li>func (b *Buffer) ReadFrom(r io.Reader) (n int64, err error)</li> <li>func (b *Buffer) WriteTo(w io.Writer) (n int64, err error)</li></ul> <p><code>ReadFrom</code>从一个reader中读取数据到缓冲区，<code>WriteTo</code>将缓冲区中的数据写入到一个writer中。例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>r <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
buf <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span>

buf<span class="token punctuation">.</span><span class="token function">ReadFrom</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
buf<span class="token punctuation">.</span><span class="token function">WriteTo</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
</code></pre></div><h2 id="reader"><a href="#reader" aria-hidden="true" class="header-anchor">#</a> Reader</h2> <p><code>bytes.Reader</code>可以将一个<code>[]byte</code>类型作为reader来使用，通过<code>NewReader</code>方法可以创建一个reader，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>r <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// hello</span>
</code></pre></div><p>其定义如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> Reader <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    s        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
    i        <span class="token builtin">int64</span> <span class="token comment">// current reading index</span>
    prevRune <span class="token builtin">int</span>   <span class="token comment">// index of previous rune; or &lt; 0</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中<code>s</code>存放着数据，<code>i</code>表示当前读取到的下标，<code>prevRune</code>记录着之前读取的一个rune的下标，用于<code>UnreadRune</code>操作。</p> <h3 id="基本操作-3"><a href="#基本操作-3" aria-hidden="true" class="header-anchor">#</a> 基本操作</h3> <ul><li>func (r *Reader) Len() int</li> <li>func (r *Reader) Size() int64</li> <li>func (r *Reader) Reset(b []byte)</li></ul> <p><code>Len</code>返回的是未读取的数据长度，<code>Size</code>返回的是总的数据长度，<code>Reset</code>重置了数据区。例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>r <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 10</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11</span>
r<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;welcome&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 7</span>
</code></pre></div><p>这几个方法的源码比较简单，不做赘述。</p> <h3 id="read-2"><a href="#read-2" aria-hidden="true" class="header-anchor">#</a> read</h3> <p>和read相关的方法有：</p> <ul><li>func (r *Reader) Read(b []byte) (n int, err error)</li> <li>func (r *Reader) ReadByte() (byte, error)</li> <li>func (r *Reader) ReadRune() (ch rune, size int, err error)</li> <li>func (r *Reader) ReadAt(b []byte, off int64) (n int, err error)</li></ul> <p>它们本质上都是讲数据从<code>reader.s</code>拷贝出来，然后更新<code>reader.i</code>的值。其中<code>ReadAt</code>是从特定位置读取数据，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>r <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">ReadAt</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// world</span>
</code></pre></div><h3 id="unread-2"><a href="#unread-2" aria-hidden="true" class="header-anchor">#</a> unread</h3> <p>有两个方法：</p> <ul><li>func (r *Reader) UnreadByte() error</li> <li>func (r *Reader) UnreadRune() error</li></ul> <p>其中<code>UnreadByte</code>只有在数据已经读取了之后才有效，<code>UnreadRune</code>只有在<code>ReadRune</code>之后才有效。源码比较简单，不做赘述。</p> <h3 id="seek"><a href="#seek" aria-hidden="true" class="header-anchor">#</a> Seek</h3> <p><code>Seek</code>方法本质上是改变了<code>reader.i</code>的值。例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>r <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

r<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>SeekStart<span class="token punctuation">)</span>
b<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// o</span>

r<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>SeekCurrent<span class="token punctuation">)</span>
b<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// r</span>

r<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> io<span class="token punctuation">.</span>SeekEnd<span class="token punctuation">)</span>
b<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// o</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="writeto"><a href="#writeto" aria-hidden="true" class="header-anchor">#</a> WriteTo</h3> <p><code>WriteTo</code>可以将数据写入到一个writer中，例如：</p> <div class="language-go extra-class"><pre class="language-go"><code>r <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">WriteTo</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/go-pkgs/bufio/" class="prev">
          bufio
        </a></span> <span class="next"><a href="/go-pkgs/strings/">
          strings
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/go-pkgs/assets/js/5.3cc74dc1.js" defer></script><script src="/go-pkgs/assets/js/app.fe7484d0.js" defer></script>
  </body>
</html>
